<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.app.user.mapper.MemberMapper">
	<select id="selectMember" resultType="MemberVO">
		SELECT m.mem_no,
				id,
				pw,
				email,
				nick,
				login_path,
				rpt_cnt,
				mem_grd
		FROM member m LEFT JOIN member_detail d 
		ON(m.mem_no=d.mem_no)
		WHERE id= #{id}
	</select>
	<select id="selectId" resultType="String">
		SELECT RPAD(SUBSTR(id,1,3),LENGTH(id),'*')
		FROM member
		WHERE id=#{id}
	</select>
	<select id="selectNick" resultType="String">
		SELECT nick
		FROM member
		WHERE nick=#{nick}
	</select>
	
	<select id="selectID" resultType="String">
		SELECT id
		FROM member
		WHERE email=#{email}
	</select>
	<select id="selectPw" resultType="String" parameterType="memberVO">
		SELECT mem_no
		FROM member
		WHERE email=#{email}
		AND id=#{id}
	</select>

	
	<insert id="insertMember" parameterType="MemberVO">
		<selectKey order="BEFORE" keyProperty="memNo"
			resultType="string">
			SELECT 'MEM' || LPAD(mem_seq.nextval,6,'0')
			FROM dual
		</selectKey>
		INSERT INTO member (mem_no,
							id,
							pw,
							email,
							nick)
		VALUES (#{memNo}, 
				#{id},
				#{pw},
				#{email},
				#{nick})
	</insert>
	<insert id="insertMemberDetail" parameterType="MemberVO">
		INSERT INTO member_detail 	(MEM_NO
									<if test="name.equals('') and name != null">
									,NAME
									</if>
									<if test="zip != 0">
									,ZIP
									</if>
									<if test="addr.equals('') and addr != null">
									,ADDR
									</if>
									<if test="detaAddr.equals('') and detaAddr != null">
									,DETA_ADDR
									</if>
									<if test="mbl.equals('') and mbl != null">
									,MBL
									</if>
									<if test="bDate.equals('') and bDate != null">
									,B_DATE
									</if>
									<if test="gen.equals('') and gen != null">
									,GEN
									</if>
									)
		VALUES ( #{memNo}
				<if test="name.equals('') and name != null">
				 ,#{name}
				 </if>
				<if test="zip != 0">
				 ,#{zip}
				 </if>
				<if test="addr.equals('') and addr != null">
				 ,#{addr}
				 </if>
				<if test="detaAddr.equals('') and detaAddr != null">
				 ,#{detaAddr}
				 </if>
				<if test="mbl.equals('') and mbl != null">
				 ,#{mbl}
				 </if>
				<if test="bDate.equals('') and bDate != null">
				 ,#{bDate}
				 </if>
				<if test="bDate.equals('') and bDate != null">
				 ,#{gen}
				 </if>
				 )
	</insert>
	
	<update id="updatePw" parameterType="memberVO">
		UPDATE member 
		SET pw=#{pw}
		WHERE mem_no=#{memNo}
	
	</update>
</mapper>