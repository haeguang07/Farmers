<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	layout:decorate="~{index}">
<head>
<meta charset="UTF-8">
<title>농작물 판매 상세 조회</title>
</head>
<body>
	<div layout:fragment="content">
		<!-- Breadcrumb Section Begin -->
		<section class="breadcrumb-option">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<div class="breadcrumb__text">
							<h4>농작물 판매</h4>
							<div class="breadcrumb__links">
								<a>농촌마켓</a>
								<a href="cropsSaleList">농작물 판매</a>
								<span th:text="${csInfo.title}">상품명</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<!-- Breadcrumb Section End -->
		<!-- Shop Details Section Begin -->
		<section class="product-details spad">
			<div class="container">
				<div class="row">
					<div class="row col-lg-12">
						<div class="col-lg-4 col-md-9">
							<div class="tab-content">
								<div class="tab-pane active" id="tabs-1" role="tabpanel">
									<div class="product__details__pic__item">
										<img th:src="${csInfo.rep}" alt="">
									</div>
								</div>
							</div>
						</div>
						<div class="product__details__content col-lg-8">
							<div class="container">
								<div class="row d-flex justify-content-center">
									<div class="col-lg-12">
										<div class="product__details__text">
											<div class="row">
												<h4 class="textLeft col-lg-9" th:text="${csInfo.title}" style="display: inline; text-align: left; font-size: 30px;">상품명</h4>
												<div th:if="not ${#strings.isEmpty(session.mem)}">
													<button type="button" class="btn btn-dark mr-2" style="width: 60px; height: 40px;" id="update" 
														th:if="${session.mem.memNo} == ${csInfo.memNo} or ${session.mem.memGrd == 'b0'}">수정</button>
													<button type="button" class="btn btn-dark" style="width: 60px; height: 40px;" id="delete" 
														th:if="${session.mem.memNo} == ${csInfo.memNo} or ${session.mem.memGrd == 'b0'}">삭제</button>
												</div>
											</div>
											<hr>
											<p style="margin-bottom: 20px; text-align: left;"><b style="font-size: 25px;">가격</b> 
												<span th:text="${#numbers.formatInteger(csInfo.price, 3, 'COMMA')} + '원'" style="font-size: 20px;"></span>
											</p>
											<p style="margin-bottom: 20px; text-align: left;"><b style="font-size: 20px;">별점</b><span>(리뷰갯수)</span> 
												<span class="rating">
													<i class="fa fa-star"></i> <i class="fa fa-star"></i> <i
														class="fa fa-star"></i> <i class="fa fa-star"></i> <i
														class="fa fa-star-o"></i>
												</span>
											</p>
											<p style="margin-bottom: 20px; text-align: left;"><b style="font-size: 15px;">판매자</b> <span th:text="${csInfo.nick}">판매자닉네임</span></p>
											<div class="product__details__cart__option" th:if="not ${#strings.isEmpty(session.mem)}">
												<p style="margin-bottom: 20px; text-align: left;"><b style="font-size: 20px;">수량 </b>
													<span><input type="number" value="1" min="1" oninput="maxValue(this)" th:if="${session.mem.memNo} != ${csInfo.memNo}" 
														id="count" class="form-control" style=" width: 150px; display: inline;"></span>
													<span><input type="number" th:value="${csInfo.qty}" th:if="${session.mem.memNo} == ${csInfo.memNo}" 
														id="count" class="form-control" style=" width: 150px; display: inline;" readonly></span>
													<span>개</span>
												</p>
											</div>
											<th:block th:if="not ${#strings.isEmpty(session.mem)}">
												<p style="margin-bottom: 20px; text-align: left;"><b style="font-size: 20px;">총액</b> <span id="sumPrice"></span></p>
												<button type="button" class="btn btn-dark mr-2" style="width: 150px; float: left;" id="buy" th:if="${session.mem.memNo} != ${csInfo.memNo}">구매하기</button>
												<button type="button" class="btn btn-dark" style="width: 150px; float: left;" id="cart" th:if="${session.mem.memNo} != ${csInfo.memNo}">장바구니 담기</button>
											</th:block>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="row col-lg-12" style="text-align: center;">
							<div class="col-lg-12">
								<div class="product__details__tab">
									<h6 style="font-size: 20px;"><b>상품 상세</b></h6>
									<hr>
									<p th:utext="${csInfo.detaDesct}">상세 설명</p>
								</div>
							</div>
						</div>
						<div class="row col-lg-12" style="text-align: center;">
							<div class="col-lg-12">
								<div class="product__details__tab">
									<h6 style="font-size: 20px;"><b>리뷰</b></h6>
									<hr>
									<p>리뷰 페이징</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<!-- Shop Details Section End -->
		
		<script th:inline="javascript">
			// 데이터에 있는 수량보다 높게 입력하려고 했을 때 실행되는 함수
			function maxValue(Object) {
				let max = /*[[${csInfo.qty}]]*/
				if(Object.value > max) {
					alert('준비된 수량보다 많습니다!');
					Object.value = max;
				}
			}
			
			/*<![CDATA[*/
			let mem = /*[[${session.mem}]]*/;
			/*]]>*/
			
			// 구매하기 버튼 클릭 시
			$('#buy').on('click', function() {
				if(mem != null) {
					
				} else {
					alert('회원만 이용할 수 있습니다. 로그인 해주세요');
					// 로그인이나 회원가입 페이지로 넘어가기
				}
			});
			
			// 장바구니 담기 버튼 클릭 시
			$('#cart').on('click', function() {
				let boardNo = /*[[${csInfo.boardNo}]]*/;
				let qty = $('#count').val();
				let boardCtg = /*[[${codeInfo}]]*/
				if(mem != null) {
					$.ajax({
						url : 'insertCart',
						data : {
							memNo : mem.memNo,
							qty : qty,
							boardNo : boardNo,
							boardCtg : boardCtg[7].cmmnDetaCode
						}
					})
				} else {
					alert('회원만 이용할 수 있습니다. 로그인 해주세요');
					// 로그인이나 회원가입 페이지로 넘어가기
				}
			});
			
			$(function() {
				getSumPrice();
			});
			
			$('#count').change(function() {
				getSumPrice();
			});
			
			function getSumPrice() {
				$('#sumPrice').text(priceToString((Number($('#count').val()) * Number([[${csInfo.price}]]))) + '원');
			}
			
			function priceToString(price) {
				return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
			}
			// 수정 버튼 클릭 시
			$('#update').on('click', function() {
				location.href="cropsSaleUpdate?boardNo=" + /*[[${csInfo.boardNo}]]*/;
			});
			// 삭제 버튼 클릭 시
			$('#delete').on('click', function() {
				let boardNo = /*[[${csInfo.boardNo}]]*/;
				console.log(boardNo);
				$.ajax({
					url : "cropsSaleDelete",
					method : "POST",
					data : 'boardNo=' + boardNo
				})
				.done(function(result) {
					console.log(result);
					location.href="cropsSaleList";
				})
				.fail(function(result) {
					alert(result);
				})
			});
		</script>
		
	</div>
</body>
</html>