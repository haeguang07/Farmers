<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{index}">

<head>
	<meta charset="UTF-8">
	<meta name="description" content="Male_Fashion Template">
	<meta name="keywords" content="Male_Fashion, unica, creative, html">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>FundingInfo</title>
	<link rel="stylesheet" href="css/sungwookCss/sungook.css" type="text/css">
</head>

<body>
	<div layout:fragment="content">
		<section class="breadcrumb-option">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<div class="breadcrumb__text">
							<h4>Shop</h4>
							<div class="breadcrumb__links">
								<a href="./index.html">농촌마켓</a> <a href="fundingList">농작물펀딩</a> <span>[[${fundingInfo.title}]]</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<hr>
		<!-- Shop Details Section Begin -->
		<section class="shop-details">
			<div class="product__details__pic" style="background-color: white;">
				<div class="container">
					<div class="row">
						<div class="row col-lg-12">
							<div class="col-lg-4 col-md-9">
								<div class="tab-content">
									<div class="tab-pane active" id="tabs-1" role="tabpanel">
										<div class="product__details__pic__item">
											<img th:src="${fundingInfo.rep}" alt="">
										</div>
									</div>
								</div>
							</div>
							<div class="product__details__content col-lg-8">
								<div class="container">
									<div class="row d-flex justify-content-center row">
										<div class="col-lg-12">
											<div class="product__details__text">
												<div class="row">
													<h4 class="textLeft col-lg-6" th:text="${fundingInfo.title}" style="display: inline;">상품명</h4>
													<h5 class="col-lg-6" style="display: inline; text-align: right;" th:text="'달성률 : ' + ${fundingInfo.goalPer}+'%'">달성률</h6>
												</div>
												<hr>
												<br>
												<div class="row">
													<p class="myInline col-lg-3 mb-0 textLeft">참여인원 </p><span th:text="${fundingInfo.payCount} + '명'" class="col-lg-3"></span>
													<p class="myInline col-lg-3 mb-0 textLeft">결제일 </p><span th:text="${#dates.format(fundingInfo.fndEndDate, 'yyyy/MM/dd')}" class="col-lg-3"></span>
												</div>
												<br>
												<div class="row">
														<p class="myInline col-lg-3 mb-0 textLeft">달성률 </p><span th:text="${fundingInfo.goalPer}+'%'" class="col-lg-3"></span>
														<p class="myInline col-lg-3 mb-0 textLeft">배송시작일</p><span th:text="${#dates.format(fundingInfo.shipStrDate, 'yyyy/MM/dd')}" class="col-lg-3"></span>
												</div>
												<br>
												<div class="row">
													<p class="myInline col-lg-3 mb-0 textLeft">펀딩가격 </p><span th:text="${#numbers.formatInteger(fundingInfo.fndPrice, 3, 'COMMA')}+원" id="fndPrice" class="col-lg-3"></span>
													<p class="myInline col-lg-3 mb-0 textLeft">판매자 </p><span th:text="${fundingInfo.nick}" class="col-lg-3"></span>
												</div>
												<br>
												<div class="row">
													<p class="myInline col-lg-3 mb-0 textLeft">펀딩기간 </p><span th:text="${#dates.format(fundingInfo.fndStrDate, 'yyyy/MM/dd')+ ' ~ ' + #dates.format(fundingInfo.fndEndDate, 'yyyy/MM/dd')}" class="col-lg-3"></span>
													<p class="myInline col-lg-3 mb-0 textLeft">목표금액 </p><span th:text="${#numbers.formatInteger(fundingInfo.goalPrice, 3, 'COMMA')}+원" class="col-lg-3"></span>
												</div>
												<div class="product__details__cart__option row" style="margin-top: 40px;">
													<div class="quantity col-lg-12 myZeroMargin" style="margin-right: 0px;">
														<div class="row memService" th:if="not ${#strings.isEmpty(session. mem)}">
															<div class="col-lg-6 textLeft row" th:if="${session.mem.memNo} != ${fundingInfo.memNo}" >
																<p class="myInline col-lg-4" style="margin-left: 0; margin-right: 0;">수량</p>
																<div class="myInline col-lg-8">
																	<input type="number" value="1" id="count" class="form-control" min="1">
																</div>
															</div>
															<div class="col-lg-6 textLeft row" style="margin-left: 30px;" th:if="${session.mem.memNo} != ${fundingInfo.memNo}" >
																<h6 class="myInlineBlock col-lg-6">총액 </h6><span id="sumPrice" class="col-lg-6"></span>
															</div>
														</div>
													</div>
													<div th:if="not ${#strings.isEmpty(session. mem)}" style="margin: 0 auto;">
														<a href="#" class="primary-btn memService"
														style="color: white; margin: 0 auto; margin-top: 20px; width: 500px;" id="getPay" th:if="${session.mem.memNo} != ${fundingInfo.memNo}" >구매하기</a>
														<a th:href="@{modifyFunding(boardNo=${fundingInfo.boardNo})}" class="primary-btn myService"
														style="color: white; margin: 0 auto; margin-top: 20px; width: 500px;" id="getModify" th:if="${session.mem.memNo} == ${fundingInfo.memNo}">수정하기</a>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="row col-lg-12">
								<div class="col-lg-12">
									<div class="product__details__tab">
										<div class="row">
											<ul class="nav nav-tabs col-lg-12" role="tablist">
												<li class="nav-item col-lg-12"><a
													class="nav-link active" data-toggle="tab" href="#tabs-5"
													role="tab">상품상세</a></li>
											</ul>
										</div>
										<div class="row">
											<div class="tab-content col-lg-12">
												<div class="tab-pane active" id="tabs-5" role="tabpanel">
													<div class="product__details__tab__content">
														<div th:utext="${fundingInfo.desct}"></div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- Related Section Begin -->
							<section class="related spad col-lg-12">
								<hr>
								<div class="container">
									<div class="row">
										<div class="col-lg-12">
											<h3 class="related-title">추천상품</h3>
										</div>
									</div>
									<div class="row">
										<div class="col-lg-3 col-md-6 col-sm-6 col-sm-6"  th:each="popular : ${polurInfo}" >
											<div class="product__item" th:onclick="|location.href='@{fundingInfo(boardNo=${popular.boardNo})}'|">
												<div class="product__item__pic set-bg" th:data-setbg="${popular.rep}" th:style='|background-image: url("${popular.rep}");|'>
													<span class="label">인기</span>
												</div>
												<div class="product__item__text">
													<h5 th:text="${popular.title}"></h5>
													<h5 th:text="${#numbers.formatInteger(popular.fndPrice, 3, 'COMMA')}+원"></h5>
												</div>
											</div>
										</div>
										<div th:if="${#strings.isEmpty(polurInfo)}" class="col-lg-12">
											<p>인기 상품이 존재하지 않습니다</p>
										</div>
									</div>
								</div>
							</section>
						</div>
					</div>
					<!-- Related Section End -->
				</div>
			</div>
		</section>

		<script th:inline="javascript">
			$(function(){
				getSumPrice()			
			})
			$('#count').change(function(){
				getSumPrice()
			})
			function getSumPrice(){	
					$('#sumPrice').text(priceToString((Number($('#count').val()) * Number(/*[[${fundingInfo.fndPrice}]]*/)))+' 원')
					
			}
			// 돈 콤마
			function priceToString(price) {
    			return price.toLocaleString('ko-KR')
			}

			//구매 페이지로 이동
			$('#getPay').on('click',function(e){
				let productList = [];

				//배열에 담을 구매상품정보 객체 생성
				let obj = {
										boardNo: /*[[${fundingInfo.boardNo}]]*/,
										qty: $(e.target).closest('.row').find('#count').val(),
										boardCtg: 'n9'
									}

				//배열에 객체  담기
				productList.push(obj)

				//상품객체배열을 json 변환 후 결제피이지 파라미터로 보냄 (한글, 특수문자가 url 인코딩이 안되서 encodeURI 사용)
				location.href = "/payment?productList=" + encodeURI(JSON.stringify(productList));
			})
		</script>
	</div>
	
</body>

</html>