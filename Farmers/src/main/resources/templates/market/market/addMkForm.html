<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{index}">

<head>
	<meta charset="UTF-8">
	<meta name="description" content="Male_Fashion Template">
	<meta name="keywords" content="Male_Fashion, unica, creative, html">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>전원마켓 등록 페이지</title>

	<style>
		.ck-editor__editable {
			height: 400px;
		}
		.primary-btn col-lg-2 {
			color: white;
			margin: 0 auto;
		}
	</style>
</head>

<body>
	<div layout:fragment="content">
		<hr>
		<!-- Shop Details Section Begin -->
		<section class="shop-details">
			<form th:action="@{/addMk}" method="POST" th:object="${mk}">
				<div class="product__details__pic" style="background-color: white;">
					<div class="container">
						<div class="row">
							<div class="row col-lg-12">
								<div class="col-lg-4 col-md-9 row" id="addFile">
									<div class="col-lg-12" style="background-color: lightgrey; display: table;">
										<p style="display: table-cell; vertical-align: middle">
											대표 이미지 등록</p>
									</div>
								</div>
								<div class="product__details__content col-lg-8">
									<form id="myForm">
										<!-- 실제 파일 업로드 input (안보임) -->
										<input type="file" id="inputFile" style="display: none;">
										<input type="text" id="insertFile" style="display: none;" name="rep" th:field="*{rep}">
										<div class="container">
											<div class="row d-flex justify-content-center row">
												<div class="col-lg-12">
													<div class="product__details__text">
														<div class="row">
															<h4 class="textLeft col-lg-3" style="display: inline;">상품명</h4>
															<input type="text" class="form-control col-lg-8" name="mktTitle" th:field="*{mktTitle}">
														</div>
														<hr>
														<div class="row">
															<div class="row col-lg-6">
																<p class="myInline col-lg-6 mb-0 textLeft">판매자</p>
																<input type="text" class="form-control col-lg-6" name="memNo" th:field="*{memNo}" readonly>
															</div>
														</div>
														<br>
														<div class="row">
															<div class="row col-lg-6">
																<p class="myInline col-lg-6 mb-0 textLeft">카테고리</p>
																<select class="form-control col-lg-6" name="mktCtg" th:field="*{mktCtg}">
																	<option value="가드닝">가드닝</option>
																	<option value="인테리어">인테리어</option>
																	<option value="잡화">잡화</option>
																</select>
															</div>
														</div>
														<br>
														<div class="row">
															<div class="row col-lg-6">
																<p class="myInline col-lg-6 mb-0 textLeft">금액</p>
																<input type="number" class="form-control col-lg-6" name="price" min="1" th:field="*{price}">
															</div>
															<div class="row col-lg-6">
																<p class="myInline col-lg-6 mb-0 textLeft">판매수량</p>
																<input type="number" class="form-control col-lg-6" name="qty" min="1" th:field="*{qty}">
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</form>
								</div>
								<div class="row col-lg-12">
									<div class="col-lg-12">
										<div class="product__details__tab">
											<div class="row">
												<ul class="nav nav-tabs col-lg-12" role="tablist">
													<li class="nav-item col-lg-12"><a class="nav-link active" data-toggle="tab" href="#tabs-5"
															role="tab">상세 설명</a></li>
												</ul>
											</div>
											<div class="row">
												<div class="tab-content col-lg-12">
													<div class="tab-pane active" id="tabs-5" role="tabpanel">
														<div class="product__details__tab__content">
															<div>
																<textarea name="text" id="editor" th:field="*{detaDesct}"></textarea>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
										<br>
										<div style="margin-top: 0px;">
											<button type="submit" class="primary-btn col-lg-2" id="addBtn">등록하기</button>
											<button type="button" class="primary-btn col-lg-2"
												th:onclick="|location.href='@{/marketList}'|">뒤로가기</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</section>


		<!-- ck 에디터-->
		<script src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/ckeditor.js"></script>
		<script src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/translations/ko.js"></script>
		<script src="https://ckeditor.com/apps/ckfinder/3.5.0/ckfinder.js"></script>

		<script>
			let dbPath;

			//첨부파일 가져오기
			$('#addFile').on('click', function () {
				$('#inputFile').click()
			})

			//첨부파일 업로드
			$('#inputFile').change(function () {
				var formData = new FormData(); //FormData 객체 생성

				var inputFile = $("input[type='file']")
				//input 태그의 type이 file인 것을 찯아서 inputFile 이라는 변수로 지정

				var files = inputFile[0].files;
				//files : 선택한 모든 파일을 나열하는 FileList 객체입니다
				//multiple 특성을 지정하지 않았다면 두 개 이상의 파일을 포함하지 않습니다

				for (var i = 0; i < files.length; i++) {
					console.log(files[i]);
					if (files[i].type.includes('image')) {
						formData.append("uploadFiles", files[i]); //키,값으로 append

						$.ajax({
							url: 'uploadsAjax',
							type: 'POST',
							processData: false, // 기본값은 true, ajax 통신을 통해 데이터를 전송할때, 기본적으로 key와 value 값을 Query String으로 변환해서 보내줌
							contentType: false, // multipart/form-data 타입을 사용하기위해 false로 지정
							data: formData,
							success: function (result) {
								console.log(result)
								dbPath = result.dbPath
								$('#addFile').html('<img src="' + result.dbPath + '">')
								$('#insertFile').val(result.dbPath);
								console.log(dbPath)

							},
							error: function (reject) {
								console.log(reject)
							}
						})
					} else {
						alert('이미지만 등록 가능합니다')
					}
				}
			})
			//ckEditor 생성
			let editor;
			ClassicEditor.create(document.querySelector('#editor'), {
					language: "ko",
					ckfinder: {
						uploadUrl: '/image/upload'
					}
				})
				.then(newEditor => {
					editor = newEditor;
				})
				.catch(error => {
					console.error(error);
				});

			//ckEditor 데이터 가져오기
			/* $('#addBtn').on('click', function () {
				let ckData = editor.getData()
				let formData = $('#myForm').serializeObject()
				formData.desct = ckData
				formData.rep = dbPath
				console.log(formData)

				$.ajax({
					url:"insertBnb",
					method : "POST",
					data : formData
				})
				.done(function(result){
					alert(result);
					location.href="bnbList"
				})
				.fail(function(result){
					alert(result);
					location.href="bnbList"
				})
			}) */
		</script>
	</div>
</body>

</html>