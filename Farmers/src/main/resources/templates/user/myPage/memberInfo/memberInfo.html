<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{user/myPage/myPage}">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Male_Fashion Template">
    <meta name="keywords" content="Male_Fashion, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>MemberInfo</title>
    <style>
        .mfp-content {
            width: 1500px;
            height: 700px;
        }
    </style>
</head>

<body>
    <div layout:fragment="myPageContent">
        <!-- Checkout Section Begin -->
        <section class="checkout spad" style="padding-top: 10px;">
            <div class="container">
                <div class="checkout__form">
                    <form action="#">
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <h6 class="checkout__title">회원정보</h6>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="checkout__input">
                                            <p>아이디<span>*</span></p>
                                            <input type="text" readonly th:value="${memberInfo.id}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="checkout__input">
                                            <p>이름</p>
                                            <input type="text" readonly th:value="|${#strings.defaultString(memberInfo.name, '')}|">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="checkout__input">
                                            <p>닉네임<span>*</span></p>
                                            <input type="text" readonly th:value="${memberInfo.nick}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="checkout__input">
                                            <p>연락처</p>
                                            <input type="text" readonly th:value="|${#strings.defaultString(memberInfo.mbl, '')}|">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="checkout__input">
                                            <p>이메일<span>*</span></p>
                                            <input type="text" readonly th:value="${memberInfo.email}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 checkout__input">
                                        <p>배송지</p><input type="text" readonly placeholder="우편번호를 검색해주세요"
                                            id="addressCode" th:value="|${#strings.defaultString(memberInfo.zip, '')}|">
                                    </div>
                                    <div class="col-lg-3 checkout__input">
                                        <p style="visibility: hidden;"><span>*</span></p>
                                    </div>
                                </div>
                                <div class="checkout__input">
                                    <input type="text" placeholder="주소지" class="checkout__input__add" id="address"
                                        readonly th:value="|${#strings.defaultString(memberInfo.addr, '')}|">
                                    <input type="text" placeholder="상세주소" id="addressDetail" readonly
                                    th:value="|${#strings.defaultString(memberInfo.detaAddr, '')}|">
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="checkout__input">
                                            <p>생년월일</p>
                                            <!-- 삼항연산자 사용 null 처리 , 함수 동시  사용 방법 1-->
                                            <input type="text" readonly th:value="${memberInfo.signDate==null? '': #dates.format(memberInfo.signDate, 'yyyy/MM/dd')}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="checkout__input">
                                            <p>성별</p>
                                            <input type="text" readonly th:if="${#strings.isEmpty(memberInfo.gen)}">
                                            <div th:if="${not #strings.isEmpty(memberInfo.gen)}">
                                                <input type="text" readonly value="남성" th:if="${#strings.equals(memberInfo.gen, 'a0')}">
                                                <input type="text" readonly value="여성" th:if="${#strings.equals(memberInfo.gen, 'a1')}">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="checkout__input">
                                            <p style="display: inline;">회원등급</p>
                                            <button type="button"
                                                class="form-control form-control-sm"
                                                style="display: inline; width: 100px; margin-left: 30px;"
                                                id="upgradeBtn">등업신청</button>
                                            <input type="text" readonly th:value="${memberInfo.memGrd}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="checkout__input">
                                            <p style="display: inline;">포인트</p>
                                            <button type="button"
                                                class="form-control form-control-sm"
                                                style="display: inline; width: 100px; margin-left: 30px;"
                                                id="pointHistory">내역조회</button>
                                            <input type="text" readonly th:value="|${#strings.defaultString(memberInfo.pnt, '')}|">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="checkout__input">
                                            <p>가입날짜</p>
                                             <!-- 삼항연산자 사용 null 처리 , 함수 동시  사용 방법 2-->
                                            <input type="text" readonly th:attr="value=${memberInfo.signDate==null? '': #dates.format(memberInfo.signDate, 'yyyy/MM/dd')}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <hr>
                <div style="display: flex; margin-top: 30px;">
                    <button type="button" class="form-control" style="width: 300px; display: inline; margin: auto;" id="modify">회원정보수정</button>
                    <button type="button" class="form-control" style="width: 300px; display: inline; margin: auto;" id="secession">회원탈퇴</button>
                </div>
            </div>
        </section>
        <!-- Checkout Section End -->

        <script th:inline="javascript">
		      //팝업창 닫기 함수
				function closePopUp(){
					var magnificPopup = $.magnificPopup.instance; 
					magnificPopup.close(); 
					location.reload();
				}
        
            //수정페이지 이동
            $('#modify').on('click',function(){
                location.href="/myPage/memberModify?memNo="+/*[[${session.mem.memNo}]]*/;
            })

            //등업신청 모달창
            $('#upgradeBtn').on('click',function(){
                console.log()
                if(/*[[${not #strings.equals(session.mem.memGrd, 'b1')}]]*/){
                    if(/*[[${not #strings.isEmpty(memberInfo.addr) and not #strings.isEmpty(memberInfo.zip)}]]*/){
                        $.magnificPopup.open({
                            items:[{
                                src:"/myPage/upgradeMember?data="+encodeURI(JSON.stringify(/*[[${memberInfo}]]*/)),
                                type: 'iframe'
                            }
                        ]
                    })
                }else{
                    new swal({
                		title: "주소를 먼저 수정하여주십시오",
                		icon : "warning",
                		confirmButtonColor: '#95D083'		
                 })
                }
            }else{
                //alert("정회원은 등업할 수 없습니다")
                new swal({
                		title: "정회원은 등업할 수 없습니다",
                		icon : "warning",
                		confirmButtonColor: '#95D083'		
                })
            }
            })
			
            //포인트 내역 모달창
              $('#pointHistory').on('click',function(){
                    $.magnificPopup.open({
				items:[{
					src:"/myPage/pointHistory?memNo="+/*[[${session.mem.memNo}]]*/,
					type: 'iframe'
				}
				]
			    })
            })

            //탈퇴
            $('#secession').on('click',function(){
                new swal({
                        title: "탈퇴하시겠습니까?",
                        icon: "info",
                        confirmButtonText: "예",
						cancelButtonText: "아니요",
						showCancelButton: true,
						allowOutsideClick: false,
                    }).then((confirm) => {
                        if (confirm.isConfirmed) {
                            new swal({
                            	title : "탈퇴를 원하시면 '탈퇴'를 입력해주세요", 
                                input: 'text',
                                inputPlaceholder: '탈퇴'
                                })
                            .then(function(value){
                                console.log(value.value)
                                if(value.value == '탈퇴'){
                                    $.ajax({
                                            url:"/myPage/secession",
                                            data : {memNo : /*[[${session.mem.memNo}]]*/}
                                        })
                                        .done(function(result){
                                            console.log(result)
                                            if(result){
                                                new swal({
                                                            title: "탈퇴가 완료되었습니다",
                                                            icon : "success",
                                                            confirmButtonColor: '#95D083'		
                                                    })
                                                    .then(function(){
                                                        location.href="/logout"
                                                    })	
                                            }else{
                                                new swal({
                                                            title: "탈퇴에 실패하였습니다",
                                                            icon : "error",
                                                            confirmButtonColor: '#95D083'		
                                                    })	
                                            }
                                        })
                                        .fail(function(){
                                            new swal({
                                                     title: "fail",
                                                    icon : "error",
                                                    confirmButtonColor: '#95D083'		
                                                    })	
                                        })
                                }else{
                                    new swal({
                                            title: "잘못 입력하였습니다",
                                            icon : "error",
                                            confirmButtonColor: '#95D083'		
                                                    })	
                                }
                            })
                        }
                    });
                
                //  if(confirm('탈퇴하시겠습니까?')){
                //     let text = prompt('"탈퇴"를 입력하여주십시오')
                //     if(text == '탈퇴'){
                //         $.ajax({
                //             url:"/myPage/secession",
                //             data : {memNo : /*[[${session.mem.memNo}]]*/}
                //         })
                //         .done(function(result){
                //             console.log(result)
                //             if(result){
                //                 alert('탈퇴 신청이 완료 되었습니다')
                //                 location.href="/logout"
                //             }else{
                //                 alert('탈퇴 신청이 실패하였습니다')
                //             }
                //         })
                //         .fail(function(){
                //             alert('탈퇴 신청이 실패하였습니다')
                //         })

                //     }else{
                //         alert('잘못 입력하였습니다')
                //     }
                // } 
            })
        </script>
    </div>

</body>

</html>